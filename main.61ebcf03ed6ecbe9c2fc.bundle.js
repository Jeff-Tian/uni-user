(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{238:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(global){__webpack_require__(20),__webpack_require__(140),__webpack_require__(25),__webpack_require__(22),__webpack_require__(810),__webpack_require__(88),__webpack_require__(213),__webpack_require__(76),__webpack_require__(811),__webpack_require__(812),__webpack_require__(46),__webpack_require__(18),__webpack_require__(75),__webpack_require__(55),__webpack_require__(26),__webpack_require__(156),__webpack_require__(27),__webpack_require__(28),__webpack_require__(813);var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(163),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(10),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(32),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_21__),antd_es_message__WEBPACK_IMPORTED_MODULE_23__=(__webpack_require__(830),__webpack_require__(246)),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(97),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_24__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(98),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_25___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_25__),react_intl__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(886);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}var ProxyFetch=function(){function ProxyFetch(){_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_24___default()(this,ProxyFetch),this.headers={"Content-Type":"application/json"},this.init={credentials:"include",mode:"cors"},this.requestCount=0,this.isLoading=!1,this.loadingTimer=null,this.intl=Object(react_intl__WEBPACK_IMPORTED_MODULE_26__.a)({locale:global.locale||"zh",messages:__webpack_require__(842).messagesForLogin[global.locale||"zh"]}),this.setMessage(antd_es_message__WEBPACK_IMPORTED_MODULE_23__.a)}var _delete2,_put,_post,_get;return _babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_25___default()(ProxyFetch,[{key:"setMessage",value:function(){this.message=antd_es_message__WEBPACK_IMPORTED_MODULE_23__.a}},{key:"showLoading",value:function(){var _this=this;0===this.requestCount&&(this.loadingTimer=setTimeout((function(){_this.message.loading(_this.intl.formatMessage({id:"text-loading"}),0),_this.isLoading=!0,_this.loadingTimer=null}),1e3)),this.requestCount++}},{key:"hideLoading",value:function(){this.requestCount--,0===this.requestCount&&(this.loadingTimer&&(clearTimeout(this.loadingTimer),this.loadingTimer=null),this.isLoading&&(this.isLoading=!1,this.message.destroy()))}},{key:"get",value:(_get=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_21___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.mark((function _callee(url){var params,settings,options,paramsArray,_args=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return params=1<_args.length&&void 0!==_args[1]?_args[1]:{},settings=2<_args.length&&void 0!==_args[2]?_args[2]:{},options={method:"GET"},params&&(paramsArray=[],Object.keys(params).forEach((function(key){if(params[key]instanceof Array){var value=params[key].map((function(item){return'"'+item+'"'}));paramsArray.push(key+"=["+value.join(",")+"]")}else paramsArray.push(key+"="+params[key])})),-1===url.search(/\?/)?url+="?"+paramsArray.join("&"):url+="&"+paramsArray.join("&")),_context.next=6,this.dofetch(url,options,settings);case 6:return _context.abrupt("return",_context.sent);case 7:case"end":return _context.stop()}}),_callee,this)}))),function(){return _get.apply(this,arguments)})},{key:"post",value:(_post=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_21___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.mark((function _callee2(url){var params,settings,options,_args2=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return params=1<_args2.length&&void 0!==_args2[1]?_args2[1]:{},settings=2<_args2.length&&void 0!==_args2[2]?_args2[2]:{},(options={method:"POST"}).body=JSON.stringify(params),_context2.next=6,this.dofetch(url,options,settings);case 6:return _context2.abrupt("return",_context2.sent);case 7:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _post.apply(this,arguments)})},{key:"put",value:(_put=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_21___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.mark((function _callee3(url){var params,settings,options,_args3=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return params=1<_args3.length&&void 0!==_args3[1]?_args3[1]:{},settings=2<_args3.length&&void 0!==_args3[2]?_args3[2]:{},(options={method:"PUT"}).body=JSON.stringify(params),_context3.next=6,this.dofetch(url,options,settings);case 6:return _context3.abrupt("return",_context3.sent);case 7:case"end":return _context3.stop()}}),_callee3,this)}))),function(){return _put.apply(this,arguments)})},{key:"delete",value:(_delete2=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_21___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.mark((function _callee4(url){var params,settings,options,_args4=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_20___default.a.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return params=1<_args4.length&&void 0!==_args4[1]?_args4[1]:{},settings=2<_args4.length&&void 0!==_args4[2]?_args4[2]:{},(options={method:"DELETE"}).body=JSON.stringify(params),_context4.next=6,this.dofetch(url,options,settings);case 6:return _context4.abrupt("return",_context4.sent);case 7:case"end":return _context4.stop()}}),_callee4,this)}))),function(){return _delete2.apply(this,arguments)})},{key:"dofetch",value:function(url,options){var _this2=this,settings=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},isServer=settings.isServer,noLoading=settings.noLoading,noClientCookies=settings.noClientCookies;isServer||noLoading||this.showLoading();var init=noClientCookies?{}:this.init;return new Promise((function(resolve,reject){Promise.race([fetch(""+url,_objectSpread({headers:_this2.headers},init,{},options)),new Promise((function(resolve,reject){setTimeout((function(){return reject(_this2.intl.formatMessage({id:"error-timeout"}))}),1e4)}))]).then((function(response){if(isServer||noLoading||_this2.hideLoading(),404===response.status)reject(_this2.intl.formatMessage({id:"error-not-found"}));else if(401===response.status)reject(_this2.intl.formatMessage({id:"error-not-authorized"}));else if(400===response.status)reject(_this2.intl.formatMessage({id:"error-bad-request"}));else if(204===response.status)resolve({success:!0});else{if(response)return response.json();resolve({success:!0})}})).then((function(json){json?(json.success,resolve(json)):reject({success:!1})})).catch((function(ex){noLoading||_this2.hideLoading(),reject(_this2.intl.formatMessage({id:"error-"+(ex.errmessage||(ex.message?ex.message.details||ex.message:"unknown"))}))}))}))}}],[{key:"getInstance",value:function(){return global.fetchInstance||(global.fetchInstance=new ProxyFetch),global.fetchInstance}}]),ProxyFetch}();__webpack_exports__.default=ProxyFetch}.call(this,__webpack_require__(19))},240:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.getAccessToken=function(){return JSON.parse(window.localStorage.getItem("gatsbyAccessToken"))}},245:function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};exports.__esModule=!0;var proxyFetch_1=__importDefault(__webpack_require__(238)),getAccessToken_1=__webpack_require__(240);proxyFetch_1.default.getInstance();exports.getProfile=function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,fetch("https://sso.jiwai.win/profile",{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+getAccessToken_1.getAccessToken()}})];case 1:return[4,_a.sent().json()];case 2:return[2,_a.sent()]}}))}))}},399:function(module,exports,__webpack_require__){__webpack_require__(400),__webpack_require__(545),__webpack_require__(546),module.exports=__webpack_require__(547)},464:function(module,exports){},546:function(module,exports){},547:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(387);module._StorybookPreserveDecorators=!0,Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)([__webpack_require__(787)],module)}.call(this,__webpack_require__(548)(module))},787:function(module,exports,__webpack_require__){var map={"./0-Welcome.stories.js":788,"./1-Button.stories.js":794,"./2-Login.stories.js":884};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=787},788:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ToStorybook",(function(){return ToStorybook}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_addon_links__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(388),_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(84);__webpack_exports__.default={title:"Welcome",component:_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Welcome};var ToStorybook=function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Welcome,{showApp:Object(_storybook_addon_links__WEBPACK_IMPORTED_MODULE_1__.linkTo)("Button")})};ToStorybook.story={name:"to Storybook"},ToStorybook.__docgenInfo={description:"",methods:[],displayName:"ToStorybook"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/0-Welcome.stories.js"]={name:"ToStorybook",docgenInfo:ToStorybook.__docgenInfo,path:"stories/0-Welcome.stories.js"})},794:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Text",(function(){return Text})),__webpack_require__.d(__webpack_exports__,"Emoji",(function(){return Emoji}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(241),_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(84);__webpack_exports__.default={title:"Button",component:_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Button};var Text=function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Button,{onClick:Object(_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("clicked")},"Hello Button")},Emoji=function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Button,{onClick:Object(_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("clicked")},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{role:"img","aria-label":"so cool"},"😀 😎 👍 💯"))};Emoji.story={name:"with emoji"},Text.__docgenInfo={description:"",methods:[],displayName:"Text"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/1-Button.stories.js"]={name:"Text",docgenInfo:Text.__docgenInfo,path:"stories/1-Button.stories.js"}),Emoji.__docgenInfo={description:"",methods:[],displayName:"Emoji"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/1-Button.stories.js"]={name:"Emoji",docgenInfo:Emoji.__docgenInfo,path:"stories/1-Button.stories.js"})},842:function(module,exports){module.exports={messagesForLogin:{}}},884:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var slicedToArray=__webpack_require__(389),slicedToArray_default=__webpack_require__.n(slicedToArray),react=__webpack_require__(0),react_default=__webpack_require__.n(react),classCallCheck=__webpack_require__(97),classCallCheck_default=__webpack_require__.n(classCallCheck),createClass=__webpack_require__(98),createClass_default=__webpack_require__.n(createClass),regenerator=__webpack_require__(10),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=__webpack_require__(32),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),proxyFetch=(__webpack_require__(18),__webpack_require__(75),__webpack_require__(238)),curry=__webpack_require__(889),getAccessToken=__webpack_require__(240),api=__webpack_require__(245),fetchInstance=proxyFetch.default.getInstance(),proxy=function(method,url){return function(params,settings){return fetchInstance[method](url,params,settings)}},isSignedIn=(curry.a(proxy)("post"),curry.a(proxy)("get"),function(){var _ref=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(Object(getAccessToken.getAccessToken)()){_context.next=3;break}return _context.abrupt("return",!1);case 3:return _context.prev=3,_context.next=6,Object(api.getProfile)();case 6:return _context.abrupt("return",!0);case 9:return _context.prev=9,_context.t0=_context.catch(3),console.error(_context.t0),_context.abrupt("return",!1);case 13:case"end":return _context.stop()}}),_callee,null,[[3,9]])})));return function(){return _ref.apply(this,arguments)}}()),getUserInfo=function(){var _ref2=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(){return regenerator_default.a.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return console.log("fetching user info..."),_context2.next=3,isSignedIn();case 3:if(!_context2.sent){_context2.next=9;break}return _context2.next=6,Object(api.getProfile)();case 6:return _context2.abrupt("return",_context2.sent);case 9:return _context2.abrupt("return",Promise.reject("请先登录！"));case 10:case"end":return _context2.stop()}}),_callee2)})));return function(){return _ref2.apply(this,arguments)}}(),fetching=!1,getUserInfoFromNetwork=function(){var _ref=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var res;return regenerator_default.a.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return console.log("get user from network..."),_context.next=3,getUserInfo();case 3:if(!(res=_context.sent).success){_context.next=6;break}return _context.abrupt("return",res.data);case 6:return _context.abrupt("return",null);case 7:case"end":return _context.stop()}}),_callee)})));return function(){return _ref.apply(this,arguments)}}(),user_UniUser=function(){function UniUser(){classCallCheck_default()(this,UniUser)}var _logout,_getInfo;return createClass_default()(UniUser,null,[{key:"getInfo",value:(_getInfo=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(){return regenerator_default.a.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return console.log("getting user..."),fetching||(fetching=getUserInfoFromNetwork()),_context2.abrupt("return",fetching);case 3:case"end":return _context2.stop()}}),_callee2)}))),function(){return _getInfo.apply(this,arguments)})},{key:"logout",value:(_logout=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(){return regenerator_default.a.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:UniUser.clearCache();case 1:case"end":return _context3.stop()}}),_callee3)}))),function(){return _logout.apply(this,arguments)})},{key:"clearCache",value:function(){fetching=!1,console.log("user cached cleared")}}]),UniUser}();__webpack_require__.d(__webpack_exports__,"CheckLoginStatus",(function(){return CheckLoginStatus}));__webpack_exports__.default={title:"登录状态",component:function(){return react_default.a.createElement("p",null,"Hello")}};var CheckLoginStatus=function(){var _useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),hasLoggedIn=_useState2[0],setHasLoggedIn=_useState2[1];return Object(react.useEffect)((function(){user_UniUser.getInfo().then((function(res){return setHasLoggedIn(null!==res)}))})),react_default.a.createElement("p",null,"用户状态：",hasLoggedIn)};CheckLoginStatus.story={name:"检查是否已登录"},CheckLoginStatus.__docgenInfo={description:"",methods:[],displayName:"CheckLoginStatus"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/2-Login.stories.js"]={name:"CheckLoginStatus",docgenInfo:CheckLoginStatus.__docgenInfo,path:"stories/2-Login.stories.js"})}},[[399,1,2]]]);
//# sourceMappingURL=main.61ebcf03ed6ecbe9c2fc.bundle.js.map