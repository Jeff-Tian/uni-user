(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{159:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(17),__webpack_require__(22),__webpack_require__(23),__webpack_require__(20),__webpack_require__(14),__webpack_require__(62),__webpack_require__(24),__webpack_require__(25);var proxyFetch=__webpack_require__(160),curry=__webpack_require__(923),getAccessToken=function(){return JSON.parse(window.localStorage.getItem("gatsbyAccessToken"))},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},getProfile=(proxyFetch.a.getInstance(),function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,fetch("https://sso.jiwai.win/profile",{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+getAccessToken()}})];case 1:return[4,_a.sent().json()];case 2:return[2,_a.sent()]}}))}))}),login_api_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},login_api_generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=0<(t=_.trys).length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},login_api_fetchInstance=proxyFetch.a.getInstance(),login_api_proxy=function(method,url){return function(params,settings){return login_api_fetchInstance[method](url,params,settings)}};curry.a(login_api_proxy)("post"),curry.a(login_api_proxy)("get");__webpack_require__.d(__webpack_exports__,"a",(function(){return UniUser}));var user_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},user_generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=0<(t=_.trys).length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},fetching=!1,UniUser=function(){function UniUser(){}return UniUser.getInfo=function(){return user_awaiter(this,void 0,void 0,(function(){return user_generator(this,(function(){return console.log("getting user..."),fetching||(fetching=user_awaiter(void 0,void 0,void 0,(function(){var res;return user_generator(this,(function(_a){switch(_a.label){case 0:return console.log("get user from network..."),[4,login_api_awaiter(void 0,void 0,void 0,(function(){return login_api_generator(this,(function(_a){switch(_a.label){case 0:return console.log("fetching user info..."),[4,login_api_awaiter(void 0,void 0,void 0,(function(){var ex_1;return login_api_generator(this,(function(_a){switch(_a.label){case 0:if(!getAccessToken())return[2,!1];_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,getProfile()];case 2:return _a.sent(),[2,!0];case 3:return ex_1=_a.sent(),console.error(ex_1),[2,!1];case 4:return[2]}}))}))];case 1:return _a.sent()?[4,getProfile()]:[3,3];case 2:return[2,_a.sent()];case 3:return[2,Promise.reject("请先登录！")]}}))}))];case 1:return(res=_a.sent()).success?[2,res.data]:[2,null]}}))}))),[2,fetching]}))}))},UniUser.loginByToken=function(){var _this=this;return function(_a){var t=_a.t;return user_awaiter(_this,void 0,void 0,(function(){return user_generator(this,(function(){return[2,console.log("token = ",t)]}))}))}},UniUser.logout=function(){return user_awaiter(this,void 0,void 0,(function(){return user_generator(this,(function(){return UniUser.clearCache(),[2]}))}))},UniUser.clearCache=function(){fetching=!1,console.log("user cached cleared")},UniUser}()},160:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global){__webpack_require__(17),__webpack_require__(22),__webpack_require__(23),__webpack_require__(28),__webpack_require__(20),__webpack_require__(812),__webpack_require__(85),__webpack_require__(36),__webpack_require__(44),__webpack_require__(14),__webpack_require__(62),__webpack_require__(54),__webpack_require__(24),__webpack_require__(152),__webpack_require__(29),__webpack_require__(25),__webpack_require__(813);var antd_lib_message__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(398),antd_lib_message__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(antd_lib_message__WEBPACK_IMPORTED_MODULE_17__),react_intl__WEBPACK_IMPORTED_MODULE_19__=(__webpack_require__(830),__webpack_require__(920)),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=0<(t=_.trys).length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},ProxyFetch=function(){function ProxyFetch(){this.headers={"Content-Type":"application/json"},this.init={credentials:"include",mode:"cors"},this.requestCount=0,this.isLoading=!1,this.loadingTimer=null,this.intl=Object(react_intl__WEBPACK_IMPORTED_MODULE_19__.a)({locale:global.locale||"zh",messages:__webpack_require__(841).messagesForLogin[global.locale||"zh"]}),this.setMessage(antd_lib_message__WEBPACK_IMPORTED_MODULE_17___default.a)}return ProxyFetch.prototype.setMessage=function(message){this.message=message},ProxyFetch.prototype.showLoading=function(){var _this=this;0===this.requestCount&&(this.loadingTimer=setTimeout((function(){_this.message.loading(_this.intl.formatMessage({id:"text-loading"}),0),_this.isLoading=!0,_this.loadingTimer=null}),1e3)),this.requestCount++},ProxyFetch.prototype.hideLoading=function(){this.requestCount--,0===this.requestCount&&(this.loadingTimer&&(clearTimeout(this.loadingTimer),this.loadingTimer=null),this.isLoading&&(this.isLoading=!1,this.message.destroy()))},ProxyFetch.getInstance=function(){return global.fetchInstance||(global.fetchInstance=new ProxyFetch),global.fetchInstance},ProxyFetch.prototype.get=function(url,params,settings){return void 0===params&&(params={}),void 0===settings&&(settings={}),__awaiter(this,void 0,void 0,(function(){var options,paramsArray_1;return __generator(this,(function(_a){switch(_a.label){case 0:return options={method:"GET"},params&&(paramsArray_1=[],Object.keys(params).forEach((function(key){if(params[key]instanceof Array){var value=params[key].map((function(item){return'"'+item+'"'}));paramsArray_1.push(key+"=["+value.join(",")+"]")}else paramsArray_1.push(key+"="+params[key])})),-1===url.search(/\?/)?url+="?"+paramsArray_1.join("&"):url+="&"+paramsArray_1.join("&")),[4,this.dofetch(url,options,settings)];case 1:return[2,_a.sent()]}}))}))},ProxyFetch.prototype.post=function(url,params,settings){return void 0===params&&(params={}),void 0===settings&&(settings={}),__awaiter(this,void 0,void 0,(function(){var options;return __generator(this,(function(_a){switch(_a.label){case 0:return(options={method:"POST"}).body=JSON.stringify(params),[4,this.dofetch(url,options,settings)];case 1:return[2,_a.sent()]}}))}))},ProxyFetch.prototype.put=function(url,params,settings){return void 0===params&&(params={}),void 0===settings&&(settings={}),__awaiter(this,void 0,void 0,(function(){var options;return __generator(this,(function(_a){switch(_a.label){case 0:return(options={method:"PUT"}).body=JSON.stringify(params),[4,this.dofetch(url,options,settings)];case 1:return[2,_a.sent()]}}))}))},ProxyFetch.prototype.delete=function(url,params,settings){return void 0===params&&(params={}),void 0===settings&&(settings={}),__awaiter(this,void 0,void 0,(function(){var options;return __generator(this,(function(_a){switch(_a.label){case 0:return(options={method:"DELETE"}).body=JSON.stringify(params),[4,this.dofetch(url,options,settings)];case 1:return[2,_a.sent()]}}))}))},ProxyFetch.prototype.dofetch=function(url,options,settings){var _this=this;void 0===settings&&(settings={});var isServer=settings.isServer,noLoading=settings.noLoading,noClientCookies=settings.noClientCookies;isServer||noLoading||this.showLoading();var init=noClientCookies?{}:this.init;return new Promise((function(resolve,reject){Promise.race([fetch(""+url,__assign(__assign({headers:_this.headers},init),options)),new Promise((function(resolve,reject){setTimeout((function(){return reject(_this.intl.formatMessage({id:"error-timeout"}))}),1e4)}))]).then((function(response){if(isServer||noLoading||_this.hideLoading(),404===response.status)reject(_this.intl.formatMessage({id:"error-not-found"}));else if(401===response.status)reject(_this.intl.formatMessage({id:"error-not-authorized"}));else if(400===response.status)reject(_this.intl.formatMessage({id:"error-bad-request"}));else if(204===response.status)resolve({success:!0});else{if(response)return response.json();resolve({success:!0})}})).then((function(json){json?(json.success,resolve(json)):reject({success:!1})})).catch((function(ex){noLoading||_this.hideLoading(),reject(_this.intl.formatMessage({id:"error-"+(ex.errmessage||(ex.message?ex.message.details||ex.message:"unknown"))}))}))}))},ProxyFetch}();__webpack_exports__.a=ProxyFetch}).call(this,__webpack_require__(12))},403:function(module,exports,__webpack_require__){__webpack_require__(404),__webpack_require__(550),__webpack_require__(551),module.exports=__webpack_require__(552)},468:function(module,exports){},551:function(module,exports){},552:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(389);module._StorybookPreserveDecorators=!0,Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)([__webpack_require__(792)],module)}.call(this,__webpack_require__(553)(module))},792:function(module,exports,__webpack_require__){var map={"./0-Welcome.stories.js":793,"./1-Button.stories.js":799,"./2-LoginStatus.stories.js":917,"./3-Login.stories.js":916,"./4-LoginCallback.stories.js":918};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=792},793:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ToStorybook",(function(){return ToStorybook}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_addon_links__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(390),_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(80);__webpack_exports__.default={title:"Welcome",component:_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Welcome};var ToStorybook=function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Welcome,{showApp:Object(_storybook_addon_links__WEBPACK_IMPORTED_MODULE_1__.linkTo)("Button")})};ToStorybook.story={name:"to Storybook"},ToStorybook.__docgenInfo={description:"",methods:[],displayName:"ToStorybook"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/0-Welcome.stories.js"]={name:"ToStorybook",docgenInfo:ToStorybook.__docgenInfo,path:"stories/0-Welcome.stories.js"})},799:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Text",(function(){return Text})),__webpack_require__.d(__webpack_exports__,"Emoji",(function(){return Emoji}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(242),_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(80);__webpack_exports__.default={title:"Button",component:_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Button};var Text=function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Button,{onClick:Object(_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("clicked")},"Hello Button")},Emoji=function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_storybook_react_demo__WEBPACK_IMPORTED_MODULE_2__.Button,{onClick:Object(_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("clicked")},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{role:"img","aria-label":"so cool"},"😀 😎 👍 💯"))};Emoji.story={name:"with emoji"},Text.__docgenInfo={description:"",methods:[],displayName:"Text"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/1-Button.stories.js"]={name:"Text",docgenInfo:Text.__docgenInfo,path:"stories/1-Button.stories.js"}),Emoji.__docgenInfo={description:"",methods:[],displayName:"Emoji"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/1-Button.stories.js"]={name:"Emoji",docgenInfo:Emoji.__docgenInfo,path:"stories/1-Button.stories.js"})},841:function(module,exports){module.exports={messagesForLogin:{}}},916:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var login_button_a,react=__webpack_require__(0),react_default=__webpack_require__.n(react),lib_button=__webpack_require__(401),button_default=__webpack_require__.n(lib_button),index_cjs=(__webpack_require__(892),__webpack_require__(95)),index_cjs_default=__webpack_require__.n(index_cjs),querystring_es3=__webpack_require__(162),querystring_es3_default=__webpack_require__.n(querystring_es3),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},w=null!=(login_button_a=window.parent)?login_button_a:window,LoginButton=function(props){return react_default.a.createElement(button_default.a,{onClick:function(){var _a,returnUrl=null!=(_a=props.returnUrl)?_a:w.location.href,ssoUrl="https://sso.pa-ca.me/app/login?r="+encodeURIComponent(returnUrl);"_blank"===props.target?function(win,ssoUrl){var popup=null;function popupLogic(){try{popup.location.href}catch(ex){console.error("打开子窗口失败：",ex),popup.close(),win.alert("之前打开的窗口已关闭, 请重新点击并在新打开的窗口中重试。")}finally{popup&&popup.postMessage(ssoUrl,win.location.origin)}}return function(dispatch){index_cjs_default.a.setStorageSync("returnPath",win.location.pathname),dispatch({type:"LOGIN"});var interval=setInterval((function(){popup?popup.closed&&(console.log("login cancelled!"),dispatch({type:"LOGGIN_CANCELLED"}),clearInterval(interval)):clearInterval(interval)}),1e3);popup&&!popup.closed||(popup=win.open())&&popup.document.write('<html>\n  <head>\n    <title>第三方登录 我的个人中心</title>\n  </head>\n  <body>\n    <p>正在加载中, 请稍等 ……</p>\n    <script>\n      window.addEventListener(\n        "message",\n        function(event) {\n          console.log(event.data);\n\n          if (\n            event.data.indexOf("http://") === 0 ||\n            event.data.indexOf("https://") === 0 ||\n            event.data.indexOf("//") === 0\n          ) {\n            window.location.href = event.data;\n          }\n        },\n        false\n      );\n\n      window.opener.postMessage("listenerLoaded", window.location.origin);\n    <\/script>\n  </body>\n</html>\n'),win.addEventListener("message",(function(event){return __awaiter(this,void 0,void 0,(function(){var tokenResult,userInfo,returnPath,ex_1;return __generator(this,(function(_a){switch(_a.label){case 0:if(console.log("event = ",event),event.origin!==win.location.origin)return[2];if(!event.data)return[2];if("listenerLoaded"===event.data)return[2,popupLogic()];if("string"!=typeof event.data||0!==event.data.indexOf("?"))return[3,6];if(tokenResult=querystring_es3_default.a.parse(event.data.substr(1)),console.log(tokenResult),!tokenResult.token)return[3,5];dispatch({type:"LOGGEDIN",token:tokenResult.token}),_a.label=1;case 1:return _a.trys.push([1,4,,5]),[4,index_cjs_default.a.request({url:"https://uniheart.pa-ca.me/jwt/user",header:{Authorization:"Bearer "+tokenResult.token},method:"GET"})];case 2:return userInfo=_a.sent(),dispatch({type:"SET_USER",user:userInfo.data}),returnPath=index_cjs_default.a.getStorageSync("returnPath"),console.log("即将跳转到：",returnPath),[4,index_cjs_default.a.navigateTo({url:returnPath,success:function(){return index_cjs_default.a.removeStorageSync("returnPath")}})];case 3:return _a.sent(),[3,5];case 4:return ex_1=_a.sent(),console.error(ex_1),[3,5];case 5:return[2,(popup||event.source).close()];case 6:return[2]}}))}))}),!1),popupLogic()}}(w,ssoUrl)(console.log):w.location.href=ssoUrl}},"登录")};__webpack_require__.d(__webpack_exports__,"LoginAction",(function(){return LoginAction}));__webpack_exports__.default={title:"登录动作",component:LoginButton};var LoginAction=function(){return react_default.a.createElement("div",null,react_default.a.createElement(LoginButton,{returnUrl:location.origin+"?path=/story/登录回调--login-callback",target:"_blank"}))};LoginAction.story={name:"登录动作"},LoginAction.__docgenInfo={description:"",methods:[],displayName:"LoginAction"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/3-Login.stories.js"]={name:"LoginAction",docgenInfo:LoginAction.__docgenInfo,path:"stories/3-Login.stories.js"})},917:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(43),__webpack_require__(14),__webpack_require__(45);var react=__webpack_require__(0),react_default=__webpack_require__.n(react),user=__webpack_require__(159);__webpack_require__.d(__webpack_exports__,"CheckLoginStatus",(function(){return CheckLoginStatus}));__webpack_exports__.default={title:"登录状态",component:function component(){return react_default.a.createElement("p",null,"Hello")}};var CheckLoginStatus=function(){var _a=Object(react.useState)(!1),hasLoggedIn=_a[0],setHasLoggedIn=_a[1];return Object(react.useEffect)((function(){user.a.getInfo().then((function(res){return setHasLoggedIn(null!==res)}))})),react_default.a.createElement("p",null,"用户已登录？",hasLoggedIn.toString())};CheckLoginStatus.story={name:"检查是否已登录"},CheckLoginStatus.__docgenInfo={description:"",methods:[],displayName:"CheckLoginStatus"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/2-LoginStatus.stories.js"]={name:"CheckLoginStatus",docgenInfo:CheckLoginStatus.__docgenInfo,path:"stories/2-LoginStatus.stories.js"})},918:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var extendStatics,react=__webpack_require__(0),react_default=__webpack_require__.n(react),index_esm=__webpack_require__(96),querystring_es3=__webpack_require__(162),querystring_es3_default=__webpack_require__.n(querystring_es3),user=__webpack_require__(159),__extends=(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},login_callback=function(_super){function Callback(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.config={navigationBarTitleText:"账号登录中，请稍等…… | 我的个人中心"},_this}return __extends(Callback,_super),Callback.prototype.componentWillReceiveProps=function(nextProps){console.log(this.props,nextProps)},Callback.prototype.componentWillUnmount=function(){},Callback.prototype.componentDidShow=function(){window.opener&&window.opener.postMessage(window.location.search,window.location.origin),this.popupLogin()},Callback.prototype.popupLogin=function(){var _this=this,tokenResult=querystring_es3_default.a.parse(window.location.search.substr(1));tokenResult.t&&user.a.loginByToken(console.log)(tokenResult).then((function(returnObj){return __awaiter(_this,void 0,void 0,(function(){var returnPath,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return(returnPath=index_esm.a.getStorageSync("returnPath"))?[4,index_esm.a.navigateTo({url:returnPath,fail:function(){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,index_esm.a.navigateTo(returnObj)];case 1:return _a.sent(),[2]}}))}))},success:function(){index_esm.a.removeStorageSync("returnPath")}})]:[3,2];case 1:return _a.sent(),[3,4];case 2:return[4,index_esm.a.navigateTo(returnObj)];case 3:_a.sent(),_a.label=4;case 4:return[2]}}))}))}))},Callback.prototype.componentDidHide=function(){},Callback.prototype.render=function(){return react_default.a.createElement("div",{className:"container"},react_default.a.createElement("p",null,"登录成功，窗口即将关闭……"))},Callback}(react_default.a.Component);__webpack_require__.d(__webpack_exports__,"LoginCallbackStory",(function(){return LoginCallbackStory}));__webpack_exports__.default={title:"登录回调",component:login_callback};var LoginCallbackStory=function(){var token=window.parent.location.href;return react_default.a.createElement("div",null,"Token = ",token,react_default.a.createElement(login_callback,null))};LoginCallbackStory.story={name:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImpvaG4iLCJzdWIiOjEsImlhdCI6MTU4MDQ1MDQ4NSwiZXhwIjoxNTgwNDUwNTQ1fQ.tW03Z688BjUy9v4s78InM3agHRHJVnn7YH7yDvIYIyQ"},LoginCallbackStory.__docgenInfo={description:"",methods:[],displayName:"LoginCallbackStory"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories/4-LoginCallback.stories.js"]={name:"LoginCallbackStory",docgenInfo:LoginCallbackStory.__docgenInfo,path:"stories/4-LoginCallback.stories.js"})}},[[403,1,2]]]);
//# sourceMappingURL=main.c9d1a9f2e77d4dbbbdc3.bundle.js.map